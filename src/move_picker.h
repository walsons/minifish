#ifndef MOVE_PICKER_H
#define MOVE_PICKER_H

#include <list>
#include "move_generator.h"
#include "history.h"

// MVV-LVA
/*
    attacker \ victim  P    A    B    N    C    R    K    p    a    b    n    c    r    k
    ---------------------------------------------------------------------------------------
       P              107  207  307  407  507  607  707  107  207  307  407  507  607  707
       A              106  206  306  406  506  606  706  106  206  306  406  506  606  706
       B              105  205  305  405  505  605  705  105  205  305  405  505  605  705
       N              104  204  304  404  504  604  704  104  204  304  404  504  604  704 
       C              103  203  303  403  503  603  703  103  203  303  403  503  603  703
       R              102  202  302  402  502  602  702  102  202  302  402  502  602  702
       K              101  201  301  401  501  601  701  101  201  301  401  501  601  701
       p              107  207  307  407  507  607  707  107  207  307  407  507  607  707
       a              106  206  306  406  506  606  706  106  206  306  406  506  606  706
       b              105  205  305  405  505  605  705  105  205  305  405  505  605  705
       n              104  204  304  404  504  604  704  104  204  304  404  504  604  704 
       c              103  203  303  403  503  603  703  103  203  303  403  503  603  703
       r              102  202  302  402  502  602  702  102  202  302  402  502  602  702
       k              101  201  301  401  501  601  701  101  201  301  401  501  601  701

*/
const int MVV_LVA[14][14] = {
    { 107, 207, 307, 407, 507, 607, 707, 107, 207, 307, 407, 507, 607, 707 },
    { 106, 206, 306, 406, 506, 606, 706, 106, 206, 306, 406, 506, 606, 706 },
    { 105, 205, 305, 405, 505, 605, 705, 105, 205, 305, 405, 505, 605, 705 },
    { 104, 204, 304, 404, 504, 604, 704, 104, 204, 304, 404, 504, 604, 704 },
    { 103, 203, 303, 403, 503, 603, 703, 103, 203, 303, 403, 503, 603, 703 },
    { 102, 202, 302, 402, 502, 602, 702, 102, 202, 302, 402, 502, 602, 702 },
    { 101, 201, 301, 401, 501, 601, 701, 101, 201, 301, 401, 501, 601, 701 },
    { 107, 207, 307, 407, 507, 607, 707, 107, 207, 307, 407, 507, 607, 707 },
    { 106, 206, 306, 406, 506, 606, 706, 106, 206, 306, 406, 506, 606, 706 },
    { 105, 205, 305, 405, 505, 605, 705, 105, 205, 305, 405, 505, 605, 705 },
    { 104, 204, 304, 404, 504, 604, 704, 104, 204, 304, 404, 504, 604, 704 },
    { 103, 203, 303, 403, 503, 603, 703, 103, 203, 303, 403, 503, 603, 703 },
    { 102, 202, 302, 402, 502, 602, 702, 102, 202, 302, 402, 502, 602, 702 },
    { 101, 201, 301, 401, 501, 601, 701, 101, 201, 301, 401, 501, 601, 701 }
};

struct ScoreMove
{
    Move move;
    int score;
};

class MovePicker
{
public:
    MovePicker(const Position& position, Move ttMove, Move killerMove[]);
    Move NextMove();
    bool NoLegalMove();

private:
    std::list<ScoreMove> GenerateCheckMove();
    std::list<ScoreMove> GenerateCaptureMove();
    std::list<ScoreMove> GenerateNonCaptureMove();

private:
    Position position_;
    Move tt_move_;
    Move killer_move1_;
    Move killer_move2_;
    MoveGenerator move_generator_;
    enum class Phase 
    {
        TT,
        CHECK,
        CAPTURE,
        KILLER,
        NON_CAPTURE,
        END,
    } phase_;
    std::list<ScoreMove> moves_;
};

#endif